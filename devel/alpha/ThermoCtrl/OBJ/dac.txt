; generated by ARM C/C++ Compiler with , RVCT4.0 [Build 524] for uVision
; commandline ArmCC [--debug -c --asm --interleave -o..\OBJ\dac.o --depend=..\OBJ\dac.d --device=DARMSTM --apcs=interwork -O0 -I..\SYSTEM\delay -I..\SYSTEM\sys -I..\SYSTEM\usart -I..\USMART -I..\HARDWARE\LED -I..\HARDWARE\BEEP -I..\HARDWARE\KEY -I..\HARDWARE\EXTI -I..\HARDWARE\WDG -I..\HARDWARE\TIMER -I..\HARDWARE\TPAD -I..\HARDWARE\OLED -I..\HARDWARE\LCD -I..\HARDWARE\RTC -I..\HARDWARE\WKUP -I..\HARDWARE\ADC -I..\HARDWARE\DAC -I..\HARDWARE\DMA -I..\HARDWARE\24CXX -I..\HARDWARE\SPI -I..\HARDWARE\FLASH -I..\USER -I..\USB\LIB -I..\USB\CONFIG -IC:\Keil\ARM\INC\ST\STM32F10x --omf_browse=..\OBJ\dac.crf ..\HARDWARE\DAC\dac.c]
                          THUMB

                          AREA ||.text||, CODE, READONLY, ALIGN=2

                  Dac1_Init PROC
;;;14     //DAC通道1输出初始化
;;;15     void Dac1_Init(void)
000000  4834              LDR      r0,|L1.212|
;;;16     {
;;;17     	RCC->APB2ENR|=1<<2;    //使能PORTA时钟	  	
000002  6980              LDR      r0,[r0,#0x18]
000004  f0400004          ORR      r0,r0,#4
000008  4932              LDR      r1,|L1.212|
00000a  6188              STR      r0,[r1,#0x18]
;;;18     	RCC->APB1ENR|=1<<29;   //使能DAC时钟	  	
00000c  4608              MOV      r0,r1
00000e  69c0              LDR      r0,[r0,#0x1c]
000010  f0405000          ORR      r0,r0,#0x20000000
000014  61c8              STR      r0,[r1,#0x1c]
;;;19     	   	 
;;;20     	GPIOA->CRL&=0XFFF0FFFF; 
000016  4830              LDR      r0,|L1.216|
000018  6800              LDR      r0,[r0,#0]
00001a  f4202070          BIC      r0,r0,#0xf0000
00001e  492f              LDR      r1,|L1.220|
000020  f8c10800          STR      r0,[r1,#0x800]
;;;21     	GPIOA->CRL|=0X00000000;//PA4 模拟输入    
000024  4608              MOV      r0,r1
000026  f8d00800          LDR      r0,[r0,#0x800]
00002a  f8c10800          STR      r0,[r1,#0x800]
;;;22     
;;;23     	DAC->CR|=1<<0;	//使能DAC1
00002e  482c              LDR      r0,|L1.224|
000030  f8d00400          LDR      r0,[r0,#0x400]
000034  f0400001          ORR      r0,r0,#1
000038  4929              LDR      r1,|L1.224|
00003a  f8c10400          STR      r0,[r1,#0x400]
;;;24     	DAC->CR|=1<<1;	//DAC1输出缓存不使能 BOFF1=1
00003e  4608              MOV      r0,r1
000040  f8d00400          LDR      r0,[r0,#0x400]
000044  f0400002          ORR      r0,r0,#2
000048  f8c10400          STR      r0,[r1,#0x400]
;;;25     	DAC->CR|=0<<2;	//不使用触发功能 TEN1=0
00004c  4608              MOV      r0,r1
00004e  f8d00400          LDR      r0,[r0,#0x400]
000052  f8c10400          STR      r0,[r1,#0x400]
;;;26     	DAC->CR|=0<<3;	//DAC TIM6 TRGO,不过要TEN1=1才行
000056  4608              MOV      r0,r1
000058  f8d00400          LDR      r0,[r0,#0x400]
00005c  f8c10400          STR      r0,[r1,#0x400]
;;;27     	DAC->CR|=0<<6;	//不使用波形发生
000060  4608              MOV      r0,r1
000062  f8d00400          LDR      r0,[r0,#0x400]
000066  f8c10400          STR      r0,[r1,#0x400]
;;;28     	DAC->CR|=0<<8;	//屏蔽、幅值设置
00006a  4608              MOV      r0,r1
00006c  f8d00400          LDR      r0,[r0,#0x400]
000070  f8c10400          STR      r0,[r1,#0x400]
;;;29     	DAC->CR|=0<<12;	//DAC1 DMA不使能    
000074  4608              MOV      r0,r1
000076  f8d00400          LDR      r0,[r0,#0x400]
00007a  491a              LDR      r1,|L1.228|
00007c  6008              STR      r0,[r1,#0]
;;;30     
;;;31     	DAC->DHR12R1=0;
00007e  2000              MOVS     r0,#0
000080  4918              LDR      r1,|L1.228|
000082  3108              ADDS     r1,r1,#8
000084  6008              STR      r0,[r1,#0]
;;;32     }
000086  4770              BX       lr
;;;33     //设置通道1输出电压
                          ENDP

                  Dac1_Set_Vol PROC
;;;34     //vol:0~3300,代表0~3.3V
;;;35     void Dac1_Set_Vol(u16 vol)
000088  b57f              PUSH     {r0-r6,lr}
;;;36     {
00008a  4604              MOV      r4,r0
;;;37     	float temp=vol;
00008c  4620              MOV      r0,r4
00008e  f7fffffe          BL       __aeabi_ui2f
000092  4605              MOV      r5,r0
;;;38     	temp/=1000;
000094  4914              LDR      r1,|L1.232|
000096  4628              MOV      r0,r5
000098  f7fffffe          BL       __aeabi_fdiv
00009c  4605              MOV      r5,r0
;;;39     	temp=temp*4096/3.3;
00009e  f04f418b          MOV      r1,#0x45800000
0000a2  4628              MOV      r0,r5
0000a4  f7fffffe          BL       __aeabi_fmul
0000a8  4606              MOV      r6,r0
0000aa  f7fffffe          BL       __aeabi_f2d
0000ae  e9cd0102          STRD     r0,r1,[sp,#8]
0000b2  a00e              ADR      r0,|L1.236|
0000b4  c80c              LDM      r0!,{r2,r3}
0000b6  9802              LDR      r0,[sp,#8]
0000b8  f7fffffe          BL       __aeabi_ddiv
0000bc  e9cd0100          STRD     r0,r1,[sp,#0]
0000c0  f7fffffe          BL       __aeabi_d2f
0000c4  4605              MOV      r5,r0
;;;40     	DAC->DHR12R1=temp;
0000c6  4628              MOV      r0,r5
0000c8  f7fffffe          BL       __aeabi_f2uiz
0000cc  4905              LDR      r1,|L1.228|
0000ce  3108              ADDS     r1,r1,#8
0000d0  6008              STR      r0,[r1,#0]
;;;41     }
0000d2  bd7f              POP      {r0-r6,pc}
;;;42     
                          ENDP

                  |L1.212|
                          DCD      0x40021000
                  |L1.216|
                          DCD      0x40010800
                  |L1.220|
                          DCD      0x40010000
                  |L1.224|
                          DCD      0x40007000
                  |L1.228|
                          DCD      0x40007400
                  |L1.232|
                          DCD      0x447a0000
                  |L1.236|
0000ec  66666666
0000f0  400a6666          DCFD     0x400a666666666666 ; 3.2999999999999998
