; generated by ARM C/C++ Compiler with , RVCT4.0 [Build 524] for uVision
; commandline ArmCC [--debug -c --asm --interleave -o..\OBJ\hw_config.o --depend=..\OBJ\hw_config.d --device=DARMSTM --apcs=interwork -O0 -I..\SYSTEM\delay -I..\SYSTEM\sys -I..\SYSTEM\usart -I..\USMART -I..\HARDWARE\LED -I..\HARDWARE\BEEP -I..\HARDWARE\KEY -I..\HARDWARE\EXTI -I..\HARDWARE\WDG -I..\HARDWARE\TIMER -I..\HARDWARE\TPAD -I..\HARDWARE\OLED -I..\HARDWARE\LCD -I..\HARDWARE\RTC -I..\HARDWARE\WKUP -I..\HARDWARE\ADC -I..\HARDWARE\DAC -I..\HARDWARE\DMA -I..\HARDWARE\24CXX -I..\HARDWARE\SPI -I..\HARDWARE\FLASH -I..\USER -I..\USB\LIB -I..\USB\CONFIG -IC:\Keil\ARM\INC\ST\STM32F10x --omf_browse=..\OBJ\hw_config.crf ..\USB\CONFIG\hw_config.c]
                          THUMB

                          AREA ||.text||, CODE, READONLY, ALIGN=2

                  Set_USBClock PROC
;;;35     //配置USB时钟,USBclk=48Mhz
;;;36     void Set_USBClock(void)
000000  482b              LDR      r0,|L1.176|
;;;37     {
;;;38      	RCC->CFGR&=~(1<<22); //USBclk=PLLclk/1.5=48Mhz	    
000002  6840              LDR      r0,[r0,#4]
000004  f4200080          BIC      r0,r0,#0x400000
000008  4929              LDR      r1,|L1.176|
00000a  6048              STR      r0,[r1,#4]
;;;39     	RCC->APB1ENR|=1<<23; //USB时钟使能					 
00000c  4608              MOV      r0,r1
00000e  69c0              LDR      r0,[r0,#0x1c]
000010  f4400000          ORR      r0,r0,#0x800000
000014  61c8              STR      r0,[r1,#0x1c]
;;;40     }
000016  4770              BX       lr
;;;41      
                          ENDP

                  Enter_LowPowerMode PROC
;;;48     *******************************************************************************/
;;;49     void Enter_LowPowerMode(void)
000018  2003              MOVS     r0,#3
;;;50     {
;;;51       /* Set the device state to suspend */
;;;52       bDeviceState = SUSPENDED;	  
00001a  4926              LDR      r1,|L1.180|
00001c  6008              STR      r0,[r1,#0]  ; bDeviceState
;;;53       /* Request to enter STOP mode with regulator in low power mode */
;;;54       //PWR_EnterSTOPMode(PWR_Regulator_LowPower, PWR_STOPEntry_WFI);
;;;55     }			  
00001e  4770              BX       lr
;;;56     
                          ENDP

                  Leave_LowPowerMode PROC
;;;63     *******************************************************************************/
;;;64     void Leave_LowPowerMode(void)
000020  4825              LDR      r0,|L1.184|
;;;65     {
;;;66       DEVICE_INFO *pInfo = &Device_Info;
;;;67     								   
;;;68     													   
;;;69       /* Set the device state to the correct state */
;;;70       if (pInfo->Current_Configuration != 0)
000022  7a81              LDRB     r1,[r0,#0xa]
000024  b119              CBZ      r1,|L1.46|
;;;71       {
;;;72         /* Device configured */
;;;73         bDeviceState = CONFIGURED;
000026  2105              MOVS     r1,#5
000028  4a22              LDR      r2,|L1.180|
00002a  6011              STR      r1,[r2,#0]  ; bDeviceState
00002c  e002              B        |L1.52|
                  |L1.46|
;;;74       }
;;;75       else
;;;76       {
;;;77         bDeviceState = ATTACHED;
00002e  2101              MOVS     r1,#1
000030  4a20              LDR      r2,|L1.180|
000032  6011              STR      r1,[r2,#0]  ; bDeviceState
                  |L1.52|
;;;78       }
;;;79     }
000034  4770              BX       lr
;;;80     
                          ENDP

                  USB_Interrupts_Config PROC
;;;81     //USB中断配置
;;;82     void USB_Interrupts_Config(void)
000036  b510              PUSH     {r4,lr}
;;;83     {
;;;84       
;;;85     	EXTI->IMR|=1<<18;//  开启线18上的中断
000038  4820              LDR      r0,|L1.188|
00003a  6800              LDR      r0,[r0,#0]
00003c  f4402080          ORR      r0,r0,#0x40000
000040  491f              LDR      r1,|L1.192|
000042  f8c10400          STR      r0,[r1,#0x400]
;;;86      	EXTI->RTSR|=1<<18;//line 18上事件上升降沿触发	 
000046  4608              MOV      r0,r1
000048  f8d00408          LDR      r0,[r0,#0x408]
00004c  f4402080          ORR      r0,r0,#0x40000
000050  f8c10408          STR      r0,[r1,#0x408]
;;;87     	MY_NVIC_Init(1,0,USB_LP_CAN_RX0_IRQChannel,2);//组2，优先级次之 
000054  2302              MOVS     r3,#2
000056  2214              MOVS     r2,#0x14
000058  2100              MOVS     r1,#0
00005a  2001              MOVS     r0,#1
00005c  f7fffffe          BL       MY_NVIC_Init
;;;88     	MY_NVIC_Init(0,0,USBWakeUp_IRQChannel,2);     //组2，优先级最高	 	 
000060  2302              MOVS     r3,#2
000062  222a              MOVS     r2,#0x2a
000064  2100              MOVS     r1,#0
000066  4608              MOV      r0,r1
000068  f7fffffe          BL       MY_NVIC_Init
;;;89     }
00006c  bd10              POP      {r4,pc}
;;;90     
                          ENDP

                  Get_SerialNum PROC
;;;91     void Get_SerialNum(void)
00006e  b510              PUSH     {r4,lr}
;;;92     {
;;;93          u32 Device_Serial0, Device_Serial1, Device_Serial2;
;;;94          Device_Serial0 = *(u32*)(0x1FFFF7E8);
000070  4b14              LDR      r3,|L1.196|
000072  6818              LDR      r0,[r3,#0]
;;;95          Device_Serial1 = *(u32*)(0x1FFFF7EC);
000074  4b14              LDR      r3,|L1.200|
000076  f8d317ec          LDR      r1,[r3,#0x7ec]
;;;96          Device_Serial2 = *(u32*)(0x1FFFF7F0);
00007a  4b12              LDR      r3,|L1.196|
00007c  3308              ADDS     r3,r3,#8
00007e  681a              LDR      r2,[r3,#0]
;;;97          if (Device_Serial0 != 0)
000080  b1a8              CBZ      r0,|L1.174|
;;;98          {
;;;99              CustomHID_StringSerial[2] = (u8)(Device_Serial0 & 0x000000FF);  
000082  4c12              LDR      r4,|L1.204|
000084  70a0              STRB     r0,[r4,#2]
;;;100    	 CustomHID_StringSerial[4] = (u8)((Device_Serial0 & 0x0000FF00) >> 8);
000086  0a03              LSRS     r3,r0,#8
000088  7123              STRB     r3,[r4,#4]
;;;101    	 CustomHID_StringSerial[6] = (u8)((Device_Serial0 & 0x00FF0000) >> 16);
00008a  0c03              LSRS     r3,r0,#16
00008c  71a3              STRB     r3,[r4,#6]
;;;102    	 CustomHID_StringSerial[8] = (u8)((Device_Serial0 & 0xFF000000) >> 24);
00008e  0e03              LSRS     r3,r0,#24
000090  7223              STRB     r3,[r4,#8]
;;;103         
;;;104    	 CustomHID_StringSerial[10] = (u8)(Device_Serial1 & 0x000000FF);  
000092  72a1              STRB     r1,[r4,#0xa]
;;;105    	 CustomHID_StringSerial[12] = (u8)((Device_Serial1 & 0x0000FF00) >> 8);
000094  0a0b              LSRS     r3,r1,#8
000096  7323              STRB     r3,[r4,#0xc]
;;;106    	 CustomHID_StringSerial[14] = (u8)((Device_Serial1 & 0x00FF0000) >> 16);
000098  0c0b              LSRS     r3,r1,#16
00009a  73a3              STRB     r3,[r4,#0xe]
;;;107    	 CustomHID_StringSerial[16] = (u8)((Device_Serial1 & 0xFF000000) >> 24);
00009c  0e0b              LSRS     r3,r1,#24
00009e  7423              STRB     r3,[r4,#0x10]
;;;108         
;;;109    	 CustomHID_StringSerial[18] = (u8)(Device_Serial2 & 0x000000FF);  
0000a0  74a2              STRB     r2,[r4,#0x12]
;;;110    	 CustomHID_StringSerial[20] = (u8)((Device_Serial2 & 0x0000FF00) >> 8);
0000a2  0a13              LSRS     r3,r2,#8
0000a4  7523              STRB     r3,[r4,#0x14]
;;;111    	 CustomHID_StringSerial[22] = (u8)((Device_Serial2 & 0x00FF0000) >> 16);
0000a6  0c13              LSRS     r3,r2,#16
0000a8  75a3              STRB     r3,[r4,#0x16]
;;;112    	 CustomHID_StringSerial[24] = (u8)((Device_Serial2 & 0xFF000000) >> 24);
0000aa  0e13              LSRS     r3,r2,#24
0000ac  7623              STRB     r3,[r4,#0x18]
                  |L1.174|
;;;113          }
;;;114    }
0000ae  bd10              POP      {r4,pc}
;;;115    /******************* (C) COPYRIGHT 2008 STMicroelectronics *****END OF FILE****/
                          ENDP

                  |L1.176|
                          DCD      0x40021000
                  |L1.180|
                          DCD      bDeviceState
                  |L1.184|
                          DCD      Device_Info
                  |L1.188|
                          DCD      0x40010400
                  |L1.192|
                          DCD      0x40010000
                  |L1.196|
                          DCD      0x1ffff7e8
                  |L1.200|
                          DCD      0x1ffff000
                  |L1.204|
                          DCD      CustomHID_StringSerial
